## ğŸŒŸ Starsoft Backend Challenge

# ğŸ“¦ Orders API

API responsible for managing `orders`. Below are all available routes, with their respective HTTP methods, payloads, and responses.

---

## ğŸ“Œ Endpoints

### ğŸ”¹ Create Order

- **Method:** `POST`  
- **Route:** `/orders`  
- **Description:** Creates a new order.

#### ğŸ“¥ Body (Request)

```json
{
  "items": [
    {
      "productId": "string",
      "quantity": 1,
      "price": 100.0
    }
  ],
}
```

#### ğŸ“¤ Response `201 Created`

```json
{
  "data": {
    "id": "order-id-gerado"
  },
  "metadata": {
    "requestId": "string",
    "timestamp": "ISODate"
  }
}
```

---

### ğŸ”¹ Search All Orders

- **Method:** `GET`
- **Route:** `/orders`
- **Description:** Returns the list of all registered orders.

#### ğŸ“¤ Response `200 OK`

```json
[
 {
   "id": "string",
   "items": [
            {
              "productId": "string",
              "quantity": 1,
              "price": 100.0
         }
        ],
   "total": 100.0,
   "status": "PENDING",
   "createdAt": "ISODate",
   "updatedAt": "ISODate"
}
]
```

---

### ğŸ”¹ Filtrar Pedidos

- **Method:** `GET` 
- **Route:** `/orders/filter` 
- **Description:** Filters orders based on the given parameters.

#### ğŸ§¾ Query Params (optional)

| Parameter | Type | Description |
|-----------|--------|---------------------------|
| id | string | Order ID |
| status | string | Order Status |
| start | string | Start Date (ISO format) |
| end | string | End Date (ISO format) |
| item | string | Item Name or ID |

#### ğŸ“¤ Response `200 OK`

```json
[
  {
    "id": "string",
    "items": [
      {
        "productId": "string",
        "quantity": 1,
        "price": 50.0
      }
    ],
    "total": 50.0,
    "status": "COMPLETED",
    "createdAt": "ISODate",
    "updatedAt": "ISODate"
  }
]
```
---

### ğŸ”¹ Update Order

- **Method:** `PUT` 
- **Route:** `/orders/:id` 
- **Description:** Updates an existing order.

#### ğŸ“¥ Body (example)

```json
{
  "status": "COMPLETED"
}
```

#### ğŸ“¤ Response `200 OK`

```json
{
  "data": {
    "id": "order_id"
  },
  "metadata": {
    "requestId": "string",
    "timestamp": "ISODate"
  }
}
```

---

### ğŸ”¹ Delete Order

- **Method:** `DELETE` 
- **Route:** `/orders/:id` 
- **Description:** Removes an order by ID.

#### ğŸ“¤ Response `204 No Content`

No body in the response.

---

## ğŸ“„ Notes

- All timestamps follow the **ISO 8601** standard.
- `requestId` and `timestamp` fields are automatically generated by the application.
- The `items` structure must contain at least one item per request.
- Possible statuses:
- `PENDING`
- `PROCESSING`
- `COMPLETED`
- `CANCELLED`
---


## ğŸ” Indexing Flows: Elasticsearch and Kafka

This document describes how the order creation and update flow integrates with **Elasticsearch** and **Kafka** within the `OrderUseCase` domain layer.

---

### ğŸ“ Order Creation (`save()`)

1. An order is saved in the repository:
```ts
const orderId = await this.orderRepository.save(input);
```

2. The system performs two asynchronous actions in parallel:
- Indexing the order in Elasticsearch:
```ts
await this.elasticOrderSearch.index(input);
```
- Publishing an event in Kafka (Order Created):
```ts
await this.eventPublisher.publishOrderCreated(input); ```

3. The operation is finalized after indexing and publishing are complete.

âœ… **Important log**:
```bash
Order [ID] indexed in ElasticSearch and event published
```

---
### ğŸ”„ Order Update (`update()`)

1. Update the order in the repository:
```ts
const updated = await this.orderRepository.update(order_id, order);
```

2. The update triggers:
- New indexing in Elasticsearch:
```ts
await this.elasticOrderSearch.index(order);
```
- Publishing the event in Kafka (Order Updated):
```ts
await this.eventPublisher.publishOrderUpdated(order);
```

3. Operations happen in parallel and are awaited with `Promise.all()`.

âœ… **Important Log**:
```bash
Order [ID] updated, re-indexed and event published
```

---

### ğŸ” Reading Operations with Elasticsearch

- **Search by status**:
```ts
return await this.elasticOrderSearch.searchByStatus(status);
```

- **Search by item name**:
```ts
return await this.elasticOrderSearch.searchByItemName(name);
```

- **Full filter with multiple parameters**:
```ts
return this.elasticOrderSearch.filterOrders(params);
```

---

### ğŸ“¦ Technologies Involved

- **Elasticsearch**: Efficient storage and search of order data. - **Kafka** (via `OrderEventPublisher`): Asynchronous communication for reactive systems and events.

---
